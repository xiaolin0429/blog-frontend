# API基础规范

## 基础信息
- **基础路径**: `/api/v1`
- **请求方式**: REST风格
- **数据格式**: JSON
- **字符编码**: UTF-8

## 请求头
- **Content-Type**: `application/json`
- **Accept**: `application/json`
- **Authorization**: `Bearer {token}` （需要认证的接口）

## 响应格式
所有接口返回JSON格式数据，包含以下字段：
```json
{
    "code": 200,    // 业务状态码，200表示成功，其他表示错误
    "message": "",  // 状态描述
    "data": null,   // 响应数据，可能是对象、数组或null
    "timestamp": "2024-01-19T10:30:00Z",  // 响应时间（ISO格式）
    "requestId": "string"                 // 请求ID，用于追踪
}
```

### 错误响应格式
1. DRF权限错误（401/403）:
```json
{
    "detail": "错误信息"
}
```

2. 业务错误:
```json
{
    "code": 400,           // 业务状态码
    "message": "错误信息",  // 错误描述
    "data": null,         // 可能包含详细错误信息
    "timestamp": "",      // 时间戳
    "requestId": ""       // 请求ID
}
```

## 分页格式
分页接口的响应数据格式如下：
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 100,          // 总记录数
        "page": 1,            // 当前页码
        "size": 10,           // 每页数量
        "pages": 10,          // 总页数
        "items": []           // 当前页数据列表
    },
    "timestamp": "2024-01-19T10:30:00Z",
    "requestId": "string"
}
```

分页接口的请求参数：
- page: 页码，从1开始（可选，默认1）
- size: 每页数量（可选，默认10，最大50）
- ordering: 排序字段（可选，字段前加-表示降序，如-created_at）

## 请求频率限制
- 未认证用户: 60次/分钟
- 已认证用户: 300次/分钟
- 超出限制返回429状态码
```json
{
    "code": 429,
    "message": "请求过于频繁，请稍后再试",
    "data": {
        "waitSeconds": 60,
        "retryAfter": "2024-01-19T10:31:00Z"
    },
    "timestamp": "2024-01-19T10:30:00Z",
    "requestId": "string"
}
```

## HTTP状态码说明
所有成功的API请求都返回HTTP状态码200，具体的业务状态通过响应体中的code字段表示。
特殊情况：
- 401: 未认证（DRF权限错误）
- 403: 权限不足（DRF权限错误）
- 404: 路由不存在
- 429: 请求过于频繁
- 500: 服务器错误

## 业务状态码
- 200: 操作成功
- 400: 请求参数错误
- 401: 未授权（未登录或token已过期）
- 403: 权限不足
- 404: 资源不存在
- 409: 资源冲突（如重复的用户名）
- 429: 请求过于频繁

## 业务错误码
### 用户相关（1000-1999）
- 1001: 用户名或密码错误
- 1002: 账号已被锁定
- 1003: 用户名已存在
- 1004: 邮箱已被使用
- 1005: 原密码错误
- 1006: Token已过期
- 1007: Token无效
- 1008: 用户已被禁用

### 文章相关（2000-2999）
- 2001: 文章标题已存在
- 2002: 文章状态不正确
- 2003: 发布时间不能修改
- 2004: 私密文章不能公开
- 2005: 文章已归档，无法修改
- 2006: 文章已发布，无法删除

### 评论相关（3000-3999）
- 3001: 评论不存在
- 3002: 父评论不存在
- 3003: 评论内容不能为空
- 3004: 评论内容超过最大长度
- 3005: 评论已被禁用
- 3006: 无权限操作此评论

### 分类相关（4000-4999）
- 4001: 分类名称已存在
- 4002: 父分类不存在
- 4003: 存在子分类，不能删除
- 4004: 分类下存在文章，不能删除
- 4005: 不能将分类设为自己的子分类
- 4006: 无权限操作此分类

### 标签相关（5000-5999）
- 5001: 标签名称已存在
- 5002: 标签不存在
- 5003: 标签下存在文章，不能删除
- 5004: 无权限操作此标签
- 5005: 批量创建标签失败

### 文件相关（6000-6999）
- 6001: 文件大小超出限制
- 6002: 不支持的文件类型
- 6003: 文件上传失败
- 6004: 文件不存在
- 6005: 无权限操作此文件

### 系统相关（9000-9999）
- 9001: 系统维护中
- 9002: 功能已禁用
- 9003: 配置无效
- 9004: 操作过于频繁
- 9005: 服务暂时不可用 